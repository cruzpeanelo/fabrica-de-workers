{% extends "base.html" %}

{% block title %}Relatorio Diario - {{ report_date }}{% endblock %}

{% block content %}
<h2>Relatorio Diario</h2>
<p style="color: #6c757d;">{{ report_date }}</p>

<div class="stats-grid">
    <div class="stat-item">
        <div class="stat-value">{{ projects_active | default(0) }}</div>
        <div class="stat-label">Projetos Ativos</div>
    </div>
    <div class="stat-item">
        <div class="stat-value">{{ stories_completed | default(0) }}</div>
        <div class="stat-label">Stories Concluidas</div>
    </div>
    <div class="stat-item">
        <div class="stat-value">{{ tasks_completed | default(0) }}</div>
        <div class="stat-label">Tasks Finalizadas</div>
    </div>
</div>

<div class="divider"></div>

<h3 style="color: #003B4A; font-size: 16px;">Resumo de Atividades</h3>

<table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
    <tr>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #6c757d; width: 50%;">Workers ativos:</td>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #333;">{{ workers_active | default(0) }} de {{ workers_total | default(0) }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #6c757d;">Tempo total de processamento:</td>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #333;">{{ total_processing_time | default('N/A') }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #6c757d;">Arquivos gerados:</td>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #333;">{{ files_generated | default(0) }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #6c757d;">Linhas de codigo:</td>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #333;">{{ lines_of_code | default(0) }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #6c757d;">Erros encontrados:</td>
        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">
            {% if errors_count > 0 %}
            <span style="color: #dc3545;">{{ errors_count }} erro(s)</span>
            {% else %}
            <span style="color: #28a745;">Nenhum erro</span>
            {% endif %}
        </td>
    </tr>
</table>

{% if projects %}
<div class="divider"></div>
<h3 style="color: #003B4A; font-size: 16px;">Projetos em Andamento</h3>

{% for project in projects %}
<div style="background-color: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px;">
    <table style="width: 100%;">
        <tr>
            <td style="width: 70%;">
                <strong style="color: #003B4A;">{{ project.name }}</strong>
                <br>
                <span style="color: #6c757d; font-size: 12px;">{{ project.id }}</span>
            </td>
            <td style="width: 30%; text-align: right;">
                {% if project.status == 'done' %}
                <span class="status-badge status-success">Concluido</span>
                {% elif project.status == 'in_progress' %}
                <span class="status-badge status-info">Em andamento</span>
                {% elif project.status == 'error' %}
                <span class="status-badge status-error">Erro</span>
                {% else %}
                <span class="status-badge status-warning">{{ project.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td colspan="2" style="padding-top: 10px;">
                <div style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div style="background-color: #28a745; width: {{ project.progress | default(0) }}%; height: 100%;"></div>
                </div>
                <span style="color: #6c757d; font-size: 11px;">{{ project.progress | default(0) }}% concluido - {{ project.stories_done | default(0) }}/{{ project.stories_total | default(0) }} stories</span>
            </td>
        </tr>
    </table>
</div>
{% endfor %}
{% endif %}

{% if completed_stories %}
<div class="divider"></div>
<h3 style="color: #003B4A; font-size: 16px;">Stories Concluidas Hoje</h3>
<ul class="list-items">
    {% for story in completed_stories[:10] %}
    <li>
        <strong>{{ story.id }}</strong> - {{ story.title }}
        <br>
        <span style="color: #6c757d; font-size: 12px;">Projeto: {{ story.project }}</span>
    </li>
    {% endfor %}
    {% if completed_stories|length > 10 %}
    <li style="color: #6c757d;">... e mais {{ completed_stories|length - 10 }} stories</li>
    {% endif %}
</ul>
{% endif %}

{% if pending_stories %}
<div class="divider"></div>
<h3 style="color: #003B4A; font-size: 16px;">Stories Pendentes (Prontas para Desenvolvimento)</h3>
<ul class="list-items">
    {% for story in pending_stories[:5] %}
    <li style="color: #333;">
        <strong>{{ story.id }}</strong> - {{ story.title }}
        <span style="float: right; color: #6c757d;">{{ story.points }} pts</span>
    </li>
    {% endfor %}
    {% if pending_stories|length > 5 %}
    <li style="color: #6c757d;">... e mais {{ pending_stories|length - 5 }} stories na fila</li>
    {% endif %}
</ul>
{% endif %}

{% if alerts %}
<div class="divider"></div>
<h3 style="color: #dc3545; font-size: 16px;">Alertas</h3>
{% for alert in alerts %}
<div style="background-color: #fff5f5; border-left: 4px solid #dc3545; padding: 10px 15px; margin: 10px 0;">
    <strong style="color: #dc3545;">{{ alert.type }}</strong>
    <p style="margin: 5px 0 0 0; color: #721c24; font-size: 13px;">{{ alert.message }}</p>
</div>
{% endfor %}
{% endif %}

<div class="divider"></div>

<p style="text-align: center;">
    <a href="{{ dashboard_url | default('#') }}" class="button">Ver Dashboard Completo</a>
</p>

<p style="text-align: center; color: #6c757d; font-size: 12px; margin-top: 20px;">
    Proximo relatorio sera enviado amanha as {{ next_report_time | default('09:00') }}.
</p>
{% endblock %}
