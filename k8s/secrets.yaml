# =============================================================================
# Fabrica de Agentes - Secrets Kubernetes
# =============================================================================
#
# ⚠️  ATENÇÃO - SEGURANÇA (Issue #167)
# ⚠️  Este arquivo contém valores EXEMPLO apenas para desenvolvimento!
# ⚠️  NUNCA use estes valores em produção!
#
# OBRIGATÓRIO EM PRODUÇÃO:
# 1. Habilitar encryption at rest no etcd do cluster K8s
# 2. Usar um dos seguintes métodos para gerenciar secrets:
#    - Sealed Secrets (Bitnami)
#    - External Secrets Operator + AWS/GCP/Azure/Vault
#    - HashiCorp Vault com CSI driver
#
# COMO HABILITAR ENCRYPTION AT REST:
#   kubectl patch secret -n kube-system encryption-config ...
#   Ou configure EncryptionConfiguration no API server
#
# Os valores abaixo sao EXEMPLOS e devem ser substituidos em producao!
# Use base64 para codificar os valores:
#   echo -n "seu_valor" | base64
#
# Aplicar com: kubectl apply -f secrets.yaml
# =============================================================================

---
# =============================================================================
# Secret Principal - Credenciais da Aplicacao
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: fabrica-agentes-secrets
  namespace: fabrica-agentes
  labels:
    app.kubernetes.io/name: fabrica-agentes
    app.kubernetes.io/component: secrets
type: Opaque
data:
  # ===========================================================================
  # ANTHROPIC API KEY - OBRIGATORIO
  # ===========================================================================
  # Substitua pelo seu API key real codificado em base64:
  # echo -n "sk-ant-api..." | base64
  ANTHROPIC_API_KEY: c2stYW50LWFwaS1rZXktZXhhbXBsZQ==  # SUBSTITUIR EM PRODUCAO

  # ===========================================================================
  # DATABASE CREDENTIALS
  # ===========================================================================
  # echo -n "fabrica" | base64 -> ZmFicmljYQ==
  DATABASE_USER: ZmFicmljYQ==
  # echo -n "fabrica_secret_strong_password" | base64
  DATABASE_PASSWORD: ZmFicmljYV9zZWNyZXRfc3Ryb25nX3Bhc3N3b3Jk

  # URL completa do banco (construida a partir dos valores acima)
  # postgresql://fabrica:fabrica_secret@postgres-service:5432/fabrica_db
  DATABASE_URL: cG9zdGdyZXNxbDovL2ZhYnJpY2E6ZmFicmljYV9zZWNyZXRAcG9zdGdyZXMtc2VydmljZTo1NDMyL2ZhYnJpY2FfZGI=

stringData:
  # ===========================================================================
  # Valores em texto plano (serao codificados automaticamente)
  # Use esta secao para facilitar a configuracao inicial
  # ===========================================================================

  # JWT Secret para autenticacao (gerar valor aleatorio em producao)
  JWT_SECRET: "fabrica-jwt-secret-change-in-production-abc123xyz"

  # Secret para sessoes do dashboard
  SESSION_SECRET: "fabrica-session-secret-change-in-production-def456"

---
# =============================================================================
# Secret de Registry - Para pull de imagens privadas
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: fabrica-registry-credentials
  namespace: fabrica-agentes
  labels:
    app.kubernetes.io/name: fabrica-agentes
    app.kubernetes.io/component: registry
type: kubernetes.io/dockerconfigjson
data:
  # Credenciais do registry (GitHub Container Registry, DockerHub, ECR, etc)
  # Gerar com: kubectl create secret docker-registry ... --dry-run=client -o yaml
  .dockerconfigjson: eyJhdXRocyI6e319  # Placeholder vazio - substituir em producao

---
# =============================================================================
# Secret de TLS - Certificados para HTTPS
# =============================================================================
# NOTA: Em producao, use cert-manager para gerenciar certificados automaticamente
# Este e apenas um placeholder/exemplo
apiVersion: v1
kind: Secret
metadata:
  name: fabrica-tls-secret
  namespace: fabrica-agentes
  labels:
    app.kubernetes.io/name: fabrica-agentes
    app.kubernetes.io/component: tls
type: kubernetes.io/tls
data:
  # Certificados TLS (substituir por certificados reais)
  # Para desenvolvimento, use cert-manager com Let's Encrypt
  tls.crt: LS0tLS1CRUdJTi...  # Placeholder - gerar certificado real
  tls.key: LS0tLS1CRUdJTi...  # Placeholder - gerar chave privada real

---
# =============================================================================
# ExternalSecret (se usando External Secrets Operator)
# =============================================================================
# Descomente e configure se estiver usando External Secrets Operator
# com AWS Secrets Manager, HashiCorp Vault, etc.

# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: fabrica-external-secrets
#   namespace: fabrica-agentes
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     kind: ClusterSecretStore
#     name: aws-secrets-manager  # ou vault, gcp, azure, etc
#   target:
#     name: fabrica-agentes-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: ANTHROPIC_API_KEY
#       remoteRef:
#         key: fabrica-agentes/anthropic
#         property: api_key
#     - secretKey: DATABASE_PASSWORD
#       remoteRef:
#         key: fabrica-agentes/database
#         property: password
