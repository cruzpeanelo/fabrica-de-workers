# ===========================================
# Fabrica de Agentes v4.0 - Environment Config
# ===========================================
# Copy this file to .env and fill in your values
# cp .env.example .env

# ===========================================
# Database (PostgreSQL)
# ===========================================
DATABASE_URL=postgresql+asyncpg://fabrica:fabrica_secret@localhost:5432/fabrica_db

# For sync operations (alembic migrations)
DATABASE_URL_SYNC=postgresql://fabrica:fabrica_secret@localhost:5432/fabrica_db

# ===========================================
# Redis (Queue and Cache)
# ===========================================
REDIS_URL=redis://localhost:6379

# ===========================================
# Authentication
# ===========================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=your-super-secret-key-change-this-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440

# ===========================================
# Claude API
# ===========================================
ANTHROPIC_API_KEY=your-anthropic-api-key-here
CLAUDE_MODEL=claude-sonnet-4-20250514

# ===========================================
# Workers
# ===========================================
MAX_WORKERS=5
WORKER_TIMEOUT=600
AUTONOMOUS_LOOP_MAX_ATTEMPTS=5

# ===========================================
# Rate Limiting
# ===========================================
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# ===========================================
# Dashboard
# ===========================================
DASHBOARD_HOST=127.0.0.1
DASHBOARD_PORT=9000

# ===========================================
# Logging
# ===========================================
LOG_LEVEL=INFO

# ===========================================
# Feature Flags
# ===========================================
LINT_ENABLED=true
TYPE_CHECK_ENABLED=true
TEST_ENABLED=true
SECURITY_SCAN_ENABLED=true

# ===========================================
# SSO Configuration (Issue #148)
# ===========================================
# Default role for SSO users without group mapping
SSO_DEFAULT_ROLE=VIEWER

# Issue #148: Group to Role mapping
# Format: GROUP_NAME:ROLE,GROUP_NAME:ROLE
# Example: Maps IdP group "Admins" to ADMIN role, "Developers" to DEVELOPER
SSO_GROUP_MAPPING=Admins:ADMIN,Managers:MANAGER,Developers:DEVELOPER,Viewers:VIEWER

# Auto-create users on first SSO login
SSO_AUTO_PROVISION=true

# Update user info on each login
SSO_UPDATE_ON_LOGIN=true

# SAML Configuration (optional)
# SAML_IDP_URL=https://idp.example.com/sso
# SAML_CERTIFICATE=base64-encoded-certificate
# SAML_ENTITY_ID=https://yourapp.com/api/auth/saml/metadata

# Azure AD Configuration (optional)
# AZURE_CLIENT_ID=your-azure-client-id
# AZURE_CLIENT_SECRET=your-azure-client-secret
# AZURE_TENANT_ID=your-azure-tenant-id

# ===========================================
# Twilio WhatsApp Integration (Issue #139)
# ===========================================
# Auth token from Twilio Console - required for webhook signature validation
# TWILIO_AUTH_TOKEN=your-twilio-auth-token
# TWILIO_ACCOUNT_SID=your-twilio-account-sid

# Set to false ONLY in development to disable signature validation
TWILIO_SIGNATURE_VALIDATION=true

# ===========================================
# Password Policy (Issue #138)
# ===========================================
# Minimum password length (production enforced)
PASSWORD_MIN_LENGTH=8

# Password complexity requirements (production enforced)
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGIT=true
PASSWORD_REQUIRE_SPECIAL=false

# ===========================================
# Data Encryption (Issue #200)
# ===========================================
# Master encryption key for field-level encryption
# Generate with: python -c "import base64; import secrets; print(base64.urlsafe_b64encode(secrets.token_bytes(32)).decode())"
# REQUIRED in production
# ENCRYPTION_MASTER_KEY=your-base64-encoded-key

# Salt for key derivation (unique per deployment)
ENCRYPTION_SALT=fabrica-agentes-v1

# Key rotation interval in days
ENCRYPTION_KEY_ROTATION_DAYS=90

# ===========================================
# HashiCorp Vault (Optional - Issue #200)
# ===========================================
VAULT_ENABLED=false
# VAULT_ADDR=http://localhost:8200
# VAULT_TOKEN=your-vault-token
VAULT_PATH_PREFIX=secret/fabrica

# ===========================================
# Backup Configuration (Issue #199)
# ===========================================
BACKUP_DIR=/var/backups/fabrica

# Backup encryption key (for encrypted backups)
# BACKUP_ENCRYPTION_KEY=your-backup-key

# S3 bucket for remote backups
# S3_BUCKET=fabrica-agentes-backups

# Slack webhook for backup failure alerts
# ALERT_WEBHOOK=https://hooks.slack.com/services/xxx

# ===========================================
# Sandbox Configuration (Issue #198)
# ===========================================
SANDBOX_ENABLED=true
SANDBOX_TIMEOUT=120
SANDBOX_MEMORY_LIMIT=512m
SANDBOX_CPU_LIMIT=1.0
SANDBOX_NETWORK=false

# ===========================================
# Environment
# ===========================================
# Set to "production" in production environments
# This enables additional security checks
ENVIRONMENT=development
